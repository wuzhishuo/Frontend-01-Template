# 第六周总结

## 本周的主要学习内容

- 有限状态机
- 浏览器基本原理之构建 DOM 树
- 浏览器基本原理之样式计算

## 有限状态机

- 有限状态机只是一种叫法，没有无限状态机
- 用途：字符串解析、游戏中角色状态切换等
- 每一个状态都是一个机器，在 JS 里面就是一个纯函数
  - 在每一个机器里，我们可以做计算、存储、输出......
  - 所有的这些机器接受的输入是一致的
  - 状态机的每一个机器本身没有状态，如果我们用函数来表示的话，它应 该是纯函数(无副作用)
- 每一个机器知道下一个状态，根据状态的不同可分为两种
  - Moore 型：每个机器都有确定的下一个状态
  - Mealy 型(常用)：每个机器根据输入决定下一个状态，Mealy 只是个人名，没有特殊含义
- JS 中的有限状态机

  ```js
  //每个函数是一个状态
  function state(input) {
    //函数参数就是输入
    //在函数中，可以自由地编写代码，处理每个状态的逻辑
    return next; //返回值作为下一个状态
  }

  /////////以下是调用//////////
  while (input) {
    //获取输入
    state = state(input); //把状态机的返回值作为下一个状态
  }
  ```

## 网页渲染流程

1. 发送请求：在地址栏输入 URL，浏览器发送 HTTP 请求到服务器
2. 获取 HTML：通过 HTTP 获取 HTML
3. 构建 DOM 树：在获取到 HTML 第一个字节以后就开始对 HTML 进行解析，形成 DOM 树
4. 样式计算：在 HTML 解析过程中遇到 CSS(内部或者外部链接)，暂停 HTML 解析，下载解析 CSS，解析完成继续解析剩下的 HTML，然后计算出 DOM 树中每个节点的具体样式
5. 布局：计算出 DOM 树中可见元素的几何位置，形成布局树
6. 绘制：根据布局树渲染成图片

### 构建 DOM 树

- 有限状态机的实践
- 利用状态机从 HTML 中解析出开始标签、结束标签、自封闭标签、属性、文本等单元信息
- 将解析得到的单元信息构建成 DOM 树
  - 使用栈构建 DOM 树，与上一步同时进行
  - 遇到开始标签时创建元素并入栈，遇到结束标签时出栈，每次出栈就是完成一个 DOM 节点的构建
  - 自封闭节点可视为入栈后立刻出栈
  - 任何元素的父元素是它入栈前的栈顶
